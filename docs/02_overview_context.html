<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Roster Crunch - 2&nbsp; Overview and Context</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03_woba_grades_graphs.html" rel="next">
<link href="./01_storytime.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02_overview_context.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Overview and Context</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./rostercrunch_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Roster Crunch</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hello!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_storytime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Story Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_overview_context.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Overview and Context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_woba_grades_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple wOBA Grades</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_woba_grades_batters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">wOBA Grades</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_woba_grades_pitchers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">wOBA Against Grades</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_career_woba.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Career wOBA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Correlation and Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_dynasty_thoughts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dynasty Thoughts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_project_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Project Process</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_project_reflections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Project Reflections</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#project-focus" id="toc-project-focus" class="nav-link active" data-scroll-target="#project-focus"><span class="header-section-number">2.1</span> Project Focus</a></li>
  <li><a href="#big-picture" id="toc-big-picture" class="nav-link" data-scroll-target="#big-picture"><span class="header-section-number">2.2</span> Big Picture</a></li>
  <li><a href="#play-by-play-data" id="toc-play-by-play-data" class="nav-link" data-scroll-target="#play-by-play-data"><span class="header-section-number">2.3</span> Play-by-Play Data</a></li>
  <li><a href="#prospect-rankings" id="toc-prospect-rankings" class="nav-link" data-scroll-target="#prospect-rankings"><span class="header-section-number">2.4</span> Prospect Rankings</a></li>
  <li><a href="#final-datasets" id="toc-final-datasets" class="nav-link" data-scroll-target="#final-datasets"><span class="header-section-number">2.5</span> Final Datasets</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><span class="header-section-number">2.6</span> Limitations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Overview and Context</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="project-focus" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="project-focus"><span class="header-section-number">2.1</span> Project Focus</h2>
<p>As I pondered the possible futures for the Rockies, I couldn’t help but wonder what a player’s rookie season tells us about that player—kind of like what an initial interaction might tell us about the possibilities of friendship or a relationship with someone we meet. In more technical terms, does a player’s rookie season performance correlate with/predict their career performance, and if so, to what extent?</p>
<p>This is a question I have been asking even more so as an avid dynasty fantasy baseball player. Before we go any further, I want to acknowledge that yes, fantasy baseball is built upon a ridiculous premise and by all accounts is a goofy hobby. But you can imagine that as a Rockies fan, the solace “fantasy” baseball provides has been prescribed by my doctor :)</p>
<p>For the uninitiated, dynasty fantasy baseball is just like regular fantasy baseball, only you also have players who have yet to reach the major leagues on your team—referred to as prospects—and you typically keep all your players as long as you like year after year. The goal is to build a “dynasty” that will win your league at least one year and ideally multiple times over.</p>
<p>Particularly because I play in a shallow dynasty league (only 12 teams) but roster a lot of prospects (20) with players losing prospect eligibility at 200 at-bats and 66 innings pitched, I am constantly faced with the predicament of whether to cut/trade or hold a prospect during their rookie season. I simply don’t have room to keep them all on my major league roster. Some players make this decision easy (Corbin Carroll last year) and others make it hard (Brandon Pfaadt last year).</p>
<p>Up until this point, I have always felt like my decisions about discarding or holding a prospect, especially less renowned prospects, were based more on feelings rather than data, too influenced by highlights and small sample sizes, and generally lacking. Perhaps you feel the same?</p>
<p>In light of this and my intrigue into Jones’ and Tovar’s futures (I also have Tovar on my fantasy team, no surprise!), I set out to analyze rookie and career performances for players who debuted over the span of 20+ years (1990 to 2010) to gain a better understanding of what this relationship has looked like historically.</p>
<p>While this project is descriptive analysis and not predictive, I like what <a href="https://twitter.com/ATCNY" target="_blank">Ariel Cohen</a>, an expert fantasy baseball player/analyst and actuary by day, I believe, <a href="https://www.rotoballer.com/2023-fantasy-takeaways/1258560?utm_source=dlvr.it&amp;utm_medium=twitter" target="_blank">writes</a>…</p>
<blockquote class="blockquote">
<p>“From an actuary’s perspective, the key motto for statistical models is that the past is predictive of the future. In my field, we base quantitative predictions on the tenet that given the same long-term conditions, past numerical outcomes and distributions (if properly parameterized) will continue for the foreseeable future.”</p>
</blockquote>
<p>While we won’t get to the point of building models, the core principle to reiterate is that the past will generally have something valuable to tell us about the present and future.</p>
<p>Ideally, what we learn will help us as fantasy baseball managers make more informed decisions when the “roster crunch” inevitably and repeatedly arrives. Maybe you just need a small edge to bring home a trophy that your loved ones will undoubtedly be so impressed by!</p>
</section>
<section id="big-picture" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="big-picture"><span class="header-section-number">2.2</span> Big Picture</h2>
<p>As dynasty managers, I submit that there are generally two inflection points at which we are forced to make a decision about one of our prospects. The first is when they reach the maximum at-bats or innings pitched at which they are no longer considered prospects, and thus must be moved to your major league roster, traded, or cut. I recognize this point varies depending on different league settings. The second is more arbitrary, but I think it is common for managers to hold their prospects for at least a full season. As fans too, we generally say things like, “He’s still only a rookie.”</p>
<p>With that said, I’ve focused on comparing both:</p>
<ul>
<li>A batter’s first 150 Plate Appearances (PA) (roughly equal to 130 At-Bats) and pitcher’s first 215 Batters Faced (BF) (roughly equal to 50 Innings Pitched) with their remaining career statistics, as this is when players <a href="https://www.mlb.com/glossary/rules/rookie-eligibility" target="_blank">officially</a> lose rookie eligibility</li>
<li>A batter’s first 600 Plate Appearances and pitcher’s first 860 Batters Faced (roughly equal to 200 Innings Pitched) with their remaining career statistics, as this is fairly equivalent to a full season
<ul>
<li>I realize 200 innings pitched is a bit high, but I wanted to keep the proportionality consistent between batters and pitchers (150 PA * 4 = 600 PA and 215 BF * 4 = 860 BF). Also, pitchers threw more innings in the past than they do now.</li>
</ul></li>
</ul>
<p>Bottom line: we need to isolate a player’s statistics up to these specific points and then compare it with their statistics after that point to determine the relationship between them.</p>
</section>
<section id="play-by-play-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="play-by-play-data"><span class="header-section-number">2.3</span> Play-by-Play Data</h2>
<p>If it’s not clear already, we’ll need play-by-play data in order to make this work. Aggregated stats for rookie seasons won’t suffice due to the differing number of plate appearances and batters faced among players.</p>
<p>I mentioned earlier that we will focus on players who debuted from 1990 through 2010 as our sample. The stats span from 1990 through 2020. You might find this sample selection a bit random, and to a certain extent you are right.</p>
<p>The primary reason I selected this sample was due to an available <a href="https://upenn.app.box.com/v/retrosheet-pa-1990-2000" target="_blank">dataset</a> that mostly met all the criteria I had:</p>
<ul>
<li>Play-by-play data</li>
<li>Large enough sample size</li>
<li>In the modern era</li>
<li>Pre-constructed, easily accessible, mostly ready to go for analysis
<ul>
<li>If you skip ahead to my Project Process and Project Reflections, you’ll see that much of what I’m doing here is a first for me.</li>
</ul></li>
<li>High quality from a trusted researcher and institution</li>
</ul>
<p>The underlying data comes from <a href="https://www.retrosheet.org" target="_blank">Retrosheet</a>. The dataset owner, <a href="https://twitter.com/RyanBrill_" target="_blank">Ryan Brill</a>, enhanced the Retrosheet data to be more useful for his research purposes like adding wOBA values for each play/event, which proved to be the linchpin for my analysis. I commend both of them to you for the fantastic work they do and acknowledge that my project exists in large part because of their labor.</p>
</section>
<section id="prospect-rankings" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="prospect-rankings"><span class="header-section-number">2.4</span> Prospect Rankings</h2>
<p>Because dynasty managers are so often making decisions based on a player’s prospect pedigree—perhaps to an even greater degree than based on a player’s initial statistics over a small sample size—I thought it necessary to also include these rankings.</p>
<p>I made use of <a href="https://www.baseballamerica.com" target="_blank">Baseball America’s</a> Top 100 Prospects preseason lists for the years of focus. Rankings like these are invaluable, reflecting a tremendous amount of work and skill that goes into scouting players and evaluating talent. I would be remiss if I did not plug subscribing to Baseball America and supporting their work if you have the means to do so.</p>
<p>We will examine player outcomes by prospect rank for prospects who made it to the major leagues. As we know, some prospects never make it to the major leagues. For reference, here are the rates of top prospects from Baseball America’s Top 100 lists (1990 - 2010) who made it to the majors.</p>
<div id="tbl-anonymous-4129116" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p><strong>Percentage and Number of Top 100 Prospects Who Reached Major Leagues</strong></p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anonymous-4129116-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anonymous-4129116" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption><strong>Batting Prospects</strong></caption>
<thead>
<tr class="header">
<th style="text-align: left;">Prospect Rank</th>
<th style="text-align: left;">Yes</th>
<th style="text-align: left;">No</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1 - 25</td>
<td style="text-align: left;">98% (138)</td>
<td style="text-align: left;">2% (3)</td>
<td style="text-align: left;">100% (141)</td>
</tr>
<tr class="even">
<td style="text-align: left;">26 - 50</td>
<td style="text-align: left;">95% (109)</td>
<td style="text-align: left;">5% (6)</td>
<td style="text-align: left;">100% (115)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">51 - 75</td>
<td style="text-align: left;">83% (96)</td>
<td style="text-align: left;">17% (19)</td>
<td style="text-align: left;">100% (115)</td>
</tr>
<tr class="even">
<td style="text-align: left;">76 - 100</td>
<td style="text-align: left;">88% (92)</td>
<td style="text-align: left;">12% (13)</td>
<td style="text-align: left;">100% (105)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">91% (435)</td>
<td style="text-align: left;">9% (41)</td>
<td style="text-align: left;">100% (476)</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-anonymous-4129116-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anonymous-4129116" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption><strong>Pitching Prospects</strong></caption>
<thead>
<tr class="header">
<th style="text-align: left;">Prospect Rank</th>
<th style="text-align: left;">Yes</th>
<th style="text-align: left;">No</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1 - 25</td>
<td style="text-align: left;">95% (99)</td>
<td style="text-align: left;">5% (5)</td>
<td style="text-align: left;">100% (104)</td>
</tr>
<tr class="even">
<td style="text-align: left;">26 - 50</td>
<td style="text-align: left;">87% (77)</td>
<td style="text-align: left;">13% (12)</td>
<td style="text-align: left;">100% (89)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">51 - 75</td>
<td style="text-align: left;">82% (100)</td>
<td style="text-align: left;">18% (22)</td>
<td style="text-align: left;">100% (122)</td>
</tr>
<tr class="even">
<td style="text-align: left;">76 - 100</td>
<td style="text-align: left;">69% (92)</td>
<td style="text-align: left;">31% (41)</td>
<td style="text-align: left;">100% (133)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">82% (368)</td>
<td style="text-align: left;">18% (80)</td>
<td style="text-align: left;">100% (448)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="final-datasets" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="final-datasets"><span class="header-section-number">2.5</span> Final Datasets</h2>
<p>Lastly, I made use of Retrosheet’s <a href="https://www.retrosheet.org/biofile.htm" target="_blank">biofile dataset</a> primarily for pulling in player debut and last game dates, as well as some additional <a href="https://www.fangraphs.com" target="_blank">FanGraphs</a> articles and datasets for both core and miscellaneous purposes. I highly recommend supporting FanGraphs by becoming a member if you can.</p>
</section>
<section id="limitations" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="limitations"><span class="header-section-number">2.6</span> Limitations</h2>
<p>All research projects have limitations, so let’s get my dirty laundry out in the open!</p>
<p>The biggest limitation is that some active players who had yet to finish their career are included in the dataset of players. Note that the stats in the dataset only go through the 2020 season, and we are including all players who debuted from 1990-2010. I made the trade-off to include those players who debuted closer to the end of that period and were still active after 2020 because I reasoned that a bigger sample size of players would enhance the analysis more than abiding by a strict rule that all players must have finished their career by then. Assuming a player debuted as late as 2010, I felt that 2011 through 2020 was a large enough amount of time for them to compile meaningful career statistics.</p>
<p>The number of batters included in this analysis is 1,891 with 52 of them still active after the 2020 season. The number of pitchers is 717 with 30 of them still active after 2020.</p>
<p>The second limitation is that we are using a single statistic, wOBA (wOBA against or wOBA allowed for pitchers), for all our evaluation. We’ll talk more about why this is a limitation, but I will note here that Baseball America’s Top 100 Prospect rankings are intended to measure a player’s complete value (not solely offensive, etc.). A much better assessment of their rankings would be performed with WAR, which many outlets have done. Nowadays, there are fantasy-specific prospect rankings, which I would have used had they existed for this time period.</p>
<p>I will address other limitations throughout the analysis.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01_storytime.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Story Time</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03_woba_grades_graphs.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple wOBA Grades</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>